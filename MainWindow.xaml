<Window x:Class="TweakerToolGUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Windows 11 Tweaker Tool by eccko"
        WindowStartupLocation="CenterScreen"
        Width="980" Height="680"
        FontFamily="Segoe UI"
        Background="{DynamicResource BrushBg}"
        Loaded="Window_Loaded">

    <!-- =================== RESOURCES =================== -->
    <Window.Resources>
        <!-- Paleta (nadpisywana w ApplyTheme) -->
        <SolidColorBrush x:Key="BrushBg"        Color="#0f172a"/>
        <SolidColorBrush x:Key="BrushSurface"   Color="#0b1220"/>
        <SolidColorBrush x:Key="BrushCard"      Color="#0d141f"/>
        <SolidColorBrush x:Key="BrushBorder"    Color="#243044"/>
        <SolidColorBrush x:Key="BrushFg"        Color="#ffffff"/>
        <SolidColorBrush x:Key="BrushSubtle"    Color="#aab7c9"/>
        <SolidColorBrush x:Key="BrushInputBg"   Color="#111a28"/>
        <!-- Hover (jasny/ciemny ustawiany w ApplyTheme) -->
        <SolidColorBrush x:Key="BrushHover"     Color="#162033"/>

        <!-- Akcent -->
        <LinearGradientBrush x:Key="AccentGrad" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#6D5EF8" Offset="0"/>
            <GradientStop Color="#3BB5FF" Offset="1"/>
        </LinearGradientBrush>

        <!-- Karta -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource BrushCard}"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BrushBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="18" ShadowDepth="0" Opacity="0.35" Color="#000"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle dla Combo – klik gdziekolwiek otwiera -->
        <ControlTemplate x:Key="ComboFullToggleTemplate" TargetType="ToggleButton">
            <Border Background="Transparent" CornerRadius="10">
                <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
            </Border>
        </ControlTemplate>

        <!-- COMBOBOX -->
        <ControlTemplate x:Key="ModernComboTemplate" TargetType="ComboBox">
            <Grid>
                <Border x:Name="Bd"
                        Background="{DynamicResource BrushInputBg}"
                        BorderBrush="{DynamicResource BrushBorder}"
                        BorderThickness="1"
                        CornerRadius="10"/>

                <ToggleButton x:Name="PART_DropDownToggle"
                              Template="{StaticResource ComboFullToggleTemplate}"
                              Background="Transparent"
                              BorderThickness="0"
                              Focusable="False"
                              FocusVisualStyle="{x:Null}"
                              ClickMode="Press"
                              IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="34"/>
                        </Grid.ColumnDefinitions>

                        <!-- Wybrana wartość -->
                        <TextBlock Margin="14,6,6,6"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource BrushFg}"
                                   FontSize="14"
                                   TextTrimming="CharacterEllipsis"
                                   Text="{Binding SelectedItem.Content, RelativeSource={RelativeSource TemplatedParent}}"/>

                        <!-- Strzałka -->
                        <Path Grid.Column="1"
                              Data="M 0 0 L 6 6 L 12 0"
                              Stroke="{DynamicResource BrushFg}"
                              StrokeThickness="2"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>
                    </Grid>
                </ToggleButton>

                <!-- Lista -->
                <Popup x:Name="PART_Popup"
                       Placement="Bottom"
                       IsOpen="{TemplateBinding IsDropDownOpen}"
                       AllowsTransparency="True"
                       PopupAnimation="Slide">
                    <Grid MinWidth="{TemplateBinding ActualWidth}" MaxHeight="{TemplateBinding MaxDropDownHeight}">
                        <Border Background="{DynamicResource BrushInputBg}"
                                BorderBrush="{DynamicResource BrushBorder}"
                                BorderThickness="1"
                                CornerRadius="10"/>
                        <ScrollViewer Margin="2,6,2,6" SnapsToDevicePixels="True">
                            <ItemsPresenter/>
                        </ScrollViewer>
                    </Grid>
                </Popup>
            </Grid>

            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Bd" Property="Background" Value="{DynamicResource BrushHover}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="ModernCombo" TargetType="ComboBox">
            <Setter Property="Template" Value="{StaticResource ModernComboTemplate}"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Foreground" Value="{DynamicResource BrushFg}"/>
            <Setter Property="Background" Value="{DynamicResource BrushInputBg}"/>
        </Style>

        <!-- Pozycje listy -->
        <Style TargetType="{x:Type ComboBoxItem}">
            <Setter Property="Foreground" Value="{DynamicResource BrushFg}"/>
            <Setter Property="Background" Value="{DynamicResource BrushInputBg}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="Chk" Text="✓" Foreground="{DynamicResource BrushSubtle}"
                                       VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0"/>
                            <ContentPresenter Grid.Column="1" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background" Value="#1a2a44"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Chk" Property="Opacity" Value="1"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Background" Value="#1a2a44"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Przyciski (neo-glass animacje) -->
        <Style x:Key="ButtonBaseModern" TargetType="Button">
            <Setter Property="Foreground" Value="{DynamicResource BrushFg}"/>
            <Setter Property="Background" Value="{DynamicResource BrushInputBg}"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid RenderTransformOrigin="0.5,0.5">
                            <Grid.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="scale" ScaleX="1" ScaleY="1"/>
                                    <TranslateTransform x:Name="move" Y="0"/>
                                </TransformGroup>
                            </Grid.RenderTransform>

                            <Border x:Name="btn" CornerRadius="12" Background="{TemplateBinding Background}">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" Opacity="0.22" BlurRadius="10" ShadowDepth="0"/>
                                </Border.Effect>
                            </Border>

                            <Border x:Name="glow" CornerRadius="12" Opacity="0" IsHitTestVisible="False">
                                <Border.Background>
                                    <RadialGradientBrush GradientOrigin="0.5,0.5" Center="0.5,0.5" RadiusX="1" RadiusY="1">
                                        <GradientStop Color="#40FFFFFF" Offset="0"/>
                                        <GradientStop Color="#00FFFFFF" Offset="1"/>
                                    </RadialGradientBrush>
                                </Border.Background>
                            </Border>

                            <Border x:Name="pressTint" CornerRadius="12" Background="#000000" Opacity="0" IsHitTestVisible="False"/>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,4,10,4"/>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="scale" Storyboard.TargetProperty="ScaleX" To="1.02" Duration="0:0:0.12"/>
                                            <DoubleAnimation Storyboard.TargetName="scale" Storyboard.TargetProperty="ScaleY" To="1.02" Duration="0:0:0.12"/>
                                            <DoubleAnimation Storyboard.TargetName="move"  Storyboard.TargetProperty="Y"      To="-1"   Duration="0:0:0.12"/>
                                            <DoubleAnimation Storyboard.TargetName="glow"  Storyboard.TargetProperty="Opacity" To="0.08" Duration="0:0:0.12"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="scale" Storyboard.TargetProperty="ScaleX" To="1" Duration="0:0:0.10"/>
                                            <DoubleAnimation Storyboard.TargetName="scale" Storyboard.TargetProperty="ScaleY" To="1" Duration="0:0:0.10"/>
                                            <DoubleAnimation Storyboard.TargetName="move"  Storyboard.TargetProperty="Y"      To="0" Duration="0:0:0.10"/>
                                            <DoubleAnimation Storyboard.TargetName="glow"  Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.10"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>

                            <Trigger Property="IsPressed" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="scale" Storyboard.TargetProperty="ScaleX" To="0.99" Duration="0:0:0.07"/>
                                            <DoubleAnimation Storyboard.TargetName="scale" Storyboard.TargetProperty="ScaleY" To="0.99" Duration="0:0:0.07"/>
                                            <DoubleAnimation Storyboard.TargetName="pressTint" Storyboard.TargetProperty="Opacity" To="0.12" Duration="0:0:0.07"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="pressTint" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.10"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="btn" Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource ButtonBaseModern}">
            <Setter Property="Background" Value="{StaticResource AccentGrad}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style x:Key="GhostButton" TargetType="Button" BasedOn="{StaticResource ButtonBaseModern}">
            <Setter Property="Background" Value="{DynamicResource BrushInputBg}"/>
        </Style>
        <Style x:Key="TinyButton" TargetType="Button" BasedOn="{StaticResource ButtonBaseModern}">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="MinHeight" Value="30"/>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource BrushFg}"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource BrushFg}"/>
            <Setter Property="Margin" Value="4,2"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Foreground" Value="{DynamicResource BrushFg}"/>
            <Setter Property="Background" Value="{DynamicResource BrushSurface}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BrushBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontFamily" Value="Consolas"/>
        </Style>
    </Window.Resources>

    <!-- =================== LAYOUT =================== -->
    <Grid Background="{DynamicResource BrushBg}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Pasek górny: ping + link + badge + selektory -->
        <Border Style="{StaticResource Card}" Margin="16,16,16,10">
            <DockPanel LastChildFill="False">

                <!-- LEWO: ping + link + badge -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                    <!-- Ping/ripple -->
                    <Grid Width="12" Height="12" Margin="0,0,10,0">
                        <Ellipse Fill="#22C55E" Width="12" Height="12"/>
                        <Ellipse Stroke="#22C55E" StrokeThickness="2" Width="12" Height="12" Opacity="0.7">
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0.6" To="0" Duration="0:0:1.5"/>
                                            <DoubleAnimation Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)" From="1" To="2.2" Duration="0:0:1.5"/>
                                            <DoubleAnimation Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)" From="1" To="2.2" Duration="0:0:1.5"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Ellipse.Triggers>
                            <Ellipse.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1" CenterX="6" CenterY="6"/>
                            </Ellipse.RenderTransform>
                        </Ellipse>
                    </Grid>

                    <!-- Link do releases -->
                    <TextBlock FontWeight="SemiBold" VerticalAlignment="Center">
                        <Hyperlink x:Name="UpdateHyperlink"
                                   NavigateUri="https://github.com/eccko/CleanCommitAI/releases"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            <Run x:Name="UpdateLinkText" Text="Check for updates"/>
                        </Hyperlink>
                    </TextBlock>

                    <!-- Badge NEW -->
                    <Border x:Name="UpdateBadge" Background="#22C55E" CornerRadius="6" Padding="6,2" Margin="8,0,0,0" Visibility="Collapsed">
                        <TextBlock x:Name="UpdateBadgeText" Text="New!" Foreground="White" FontSize="12" FontWeight="Bold"/>
                    </Border>
                </StackPanel>

                <!-- PRAWO: selektory -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock x:Name="ThemeLabel" Text="Theme:" Foreground="{DynamicResource BrushSubtle}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <ComboBox x:Name="ThemeSelector" Width="160" Style="{StaticResource ModernCombo}" SelectionChanged="ThemeSelector_Changed" Margin="0,0,10,0">
                        <ComboBoxItem Content="System" IsSelected="True"/>
                        <ComboBoxItem Content="Dark"/>
                        <ComboBoxItem Content="Light"/>
                    </ComboBox>

                    <TextBlock x:Name="LanguageLabel" Text="Language:" Foreground="{DynamicResource BrushSubtle}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <ComboBox x:Name="LanguageSelector" Width="170" Style="{StaticResource ModernCombo}" SelectionChanged="LanguageSelector_Changed">
                        <ComboBoxItem Content="English" IsSelected="True"/>
                        <ComboBoxItem Content="Polski"/>
                        <ComboBoxItem Content="Русский"/>
                        <ComboBoxItem Content="Deutsch"/>
                        <ComboBoxItem Content="Español"/>
                    </ComboBox>
                </StackPanel>

            </DockPanel>
        </Border>

        <!-- Lista skryptów / tweaków -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="16,0,16,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <DockPanel Grid.Row="0" LastChildFill="False" Margin="0,0,0,8">
                    <TextBlock x:Name="TweaksHeader" DockPanel.Dock="Left" Text="Available Tweaks" Foreground="{DynamicResource BrushSubtle}" />
                </DockPanel>

                <ScrollViewer Grid.Row="1">
                    <StackPanel x:Name="ScriptList"/>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Przyciski -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Margin="16,0,16,12">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button x:Name="RunButton"    Style="{StaticResource PrimaryButton}" Content="▶ Run Tweaks" Width="240" Click="RunButton_Click" Margin="0,0,12,0"/>
                <Button x:Name="UploadButton" Style="{StaticResource GhostButton}"   Content="📂 Upload custom" Width="220" Click="UploadButton_Click"/>
            </StackPanel>
        </Border>

        <!-- Log + kopiuj -->
        <Border Grid.Row="3" Style="{StaticResource Card}" Margin="16,0,16,12" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0" LastChildFill="False" Margin="12,10,12,6">
                    <TextBlock x:Name="LogHeader" Text="Log" Foreground="{DynamicResource BrushSubtle}" DockPanel.Dock="Left"/>
                    <Button x:Name="CopyLogButton" Style="{StaticResource TinyButton}" Content="📋 Copy log" DockPanel.Dock="Right" Click="CopyLogButton_Click"/>
                </DockPanel>

                <TextBox Grid.Row="1" x:Name="LogBox"
                         Margin="12,0,12,12"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"/>
            </Grid>
        </Border>

        <!-- Wersja -->
        <TextBlock Grid.Row="4"
                   Text="Version 0.1 BETA — 10.09.2025"
                   Foreground="{DynamicResource BrushSubtle}"
                   FontSize="12"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Margin="0,0,18,10"/>
    </Grid>
</Window>
